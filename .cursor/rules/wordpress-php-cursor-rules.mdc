---
description: SFX child theme architecture and PHP rules
globs: **/*.php
alwaysApply: true
---
# SFX Bricks Child Theme context

## Architecture
- Entry: `functions.php` loads Composer autoloader or a PSR-4 fallback (`SFX\*` -> `inc/`).
- Theme init: `SFX\SFXBricksChildTheme::init()` (consolidated hook phases + asset loading).
- Feature registry: `inc/*/Controller.php` must implement `get_feature_config()` and is auto-registered.
- Admin UI: `SFX\SFXBricksChildAdmin` renders feature cards from the registry.
- Access control: `AccessControl` uses `SFX_THEME_ADMINS` (role or capability) and `SFX_THEME_DASHBOARD` (usernames). If undefined, access is locked.
- Assets:
  - Frontend: `assets/css/frontend/styles.css`
  - Builder: `assets/css/builder/styles.css`
  - Admin: `assets/css/backend/styles.css`
- Bricks elements: registered from `elements/*.php`.
- CPTs: `sfx_custom_script`, `sfx_contact_info`, `sfx_social_account` (excluded from sitemaps).

## PHP / WordPress rules (complete but concise)
- Use PHP 8+ features where helpful; add `declare(strict_types=1);` in new PHP files.
- Favor OOP, modularity, and reusable helpers; avoid duplication.
- Prefer WordPress APIs (Options, Settings, CPT, AJAX, REST, WP_Query) over custom plumbing.
- Always sanitize/validate input and escape output (`sanitize_*`, `esc_*`).
- Enforce nonces and capability checks for admin pages, forms, and AJAX.
- Use `$wpdb->prepare()` for dynamic SQL; use `dbDelta()` for schema changes.
- Implement error handling and logging (WP debug log; try/catch for expected exceptions).
- Use hooks (actions/filters) for extensibility; do not modify core.
- Use translation functions (`__()`, `_e()`) and load text domains.
- Enqueue assets via `wp_enqueue_script()` / `wp_enqueue_style()`.
- Use roles/capabilities for access control; avoid direct user meta checks.
- Use Transients for caching and `wp_cron` for background tasks.
- Register CPTs and taxonomies via core APIs.
- Implement pagination via core utilities (e.g., `paginate_links()`).
  